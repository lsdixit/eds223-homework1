---
title: "ej_screen"
format: html
editor_options: 
  chunk_output_type: console
---

# Exploring Environmental (in)justice

The United States Environmental Protection Agency defines Environmental Justice as "the just treatment and meaningful involvement of all people, regardless of income, race, color, national origin, Tribal affiliation, or disability". In this project, I will be exploring particulate pollution in California and exploring which groups might be disproportionately affected by poor air quality. 

Step 1: Load in necessary packages.
```{r}
rm(list = ls())
library(tidyverse)
library(sf)
library(here)
library(tmap)
```

Step 2: Read in environmental justice data and clean for mapping.
```{r}
# read in geodatabase of EJScreen data at the Census Block Group level
ejscreen <- sf::st_read(here::here("data", "data", "ejscreen","EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb")) 

# filter to California only
california <- ejscreen %>%
  dplyr::filter(ST_ABBREV == "CA") %>% 
  drop_na(c("P_D2_CANCER", "P_PTRAF", "LIFEEXPPCT"))

# calculate the mean for each EJ variable, by county
ca_counties <- aggregate(california, by = list(california$CNTY_NAME), FUN = mean)

# separate the county names into name and county, and remove the "county" string
ca_counties <- separate(ca_counties, Group.1, 
                        into = c("county", "county_name"), sep = " ")
ca_counties <- select(ca_counties, -c("county_name"))
```

Step 3: Map 1
The map below represents the estimated lifetime inhalation cancer risk as a result of carcinogens present in the air. This value is persons per million over a 70-year lifetime. EJScreen presents these data as a percentile for better comparison.
```{r}
# percentile of airborne toxics that can lead to cancer, by county in California
tm_shape(ca_counties) +
  tm_polygons(fill = "P_D2_CANCER",
              fill.legend = tm_legend(title = "Lifetime Cancer Risk Percentile",
                                      orientation = "landscape",
                                      position = tm_pos_out("center", "bottom"), frame = FALSE),
              fill.scale = tm_scale(labels = c("Below 19th", "20th to 39th", "40th to 59th", "60th to 80th"))) +
  tm_title("Lifetime cancer risk via inhalation of toxins, by county", 
           frame = FALSE,
           size = 1) +
  tm_scalebar(position = "right") +
  tm_compass(position = c("left", "bottom"))

```
This map shows that counties of the central valley (San Joaquin Valley) are generally in a higher percentile for cancer risk via inhalation of airborne toxins. There could be a few potential causes of increased carcinogens in outside air:

- Nearby I-5 and Highway 99 introduce pollution sources, such as diesel locomotives.
- Vehicle emissions from these roadways, tractors and irrigation pumps from local agriculture, and wood burning stoves/fireplaces all contribute to fine particulate matter (PM2.5).
- Topography from surrounding mountains create a "bowl", trapping these pollutants.

Step 4: Maps 2 and 3
We will zoom in to a few counties to get a more detailed view of any patterns that might emerge between airborne toxics and underrepresented communities.

```{r}
# zoom in on a few higher risk counties from the cancer index to look at things like PM2.5, diesel, and further demographic information

# sort them and choose top 3
ca_counties %>% 
  select(county, P_D2_CANCER) %>% 
  arrange(desc(P_D2_CANCER))
# In order: Sacramento, Tulare, Yuba Counties

# subset full data set for top 3
top3 <- c("Sacramento County", "Tulare County", "Yuba County")
top3_county <- california %>% 
  filter(CNTY_NAME %in% top3) %>% 
  rename("Cancer Risk" = "P_D2_CANCER",
         "Diesel Particulate Matter" = "P_D2_DSLPM",
         "PM 2.5" = "P_D2_PM25",
         "People of Color" = "P_PEOPCOLORPCT",
         "Low Life Expectancy" = "P_LIFEEXPPCT",
         "Low Income" = "P_LOWINCPCT")

# subset full data for just Sacramento County, the highest inhalation cancer risk county
top3_sac <- california %>% 
  filter(CNTY_NAME == "Sacramento County") %>% 
  rename("Cancer Risk" = "P_D2_CANCER",
         "Diesel Particulate Matter" = "P_D2_DSLPM",
         "PM 2.5" = "P_D2_PM25",
         "People of Color" = "P_PEOPCOLORPCT",
         "Low Life Expectancy" = "P_LIFEEXPPCT",
         "Low Income" = "P_LOWINCPCT")
```


We will first take a look closer into the three counties with the highest inhalation cancer risk"
- Sacramento County
- Tulare County
- Yuba County

```{r}
# bivariate plot of one cancer risk by POC for top 3 counties
tm_shape(top3_county) +
  tm_fill(tm_vars(c("Cancer Risk", "People of Color"),
                  multivariate = TRUE)) +
  tm_facets("CNTY_NAME") +
  tm_title("Percentile of People of Color by Percentile of Inhalation Cancer Risk 
(top 3 highest risk counties)")
  tm_scalebar(position = "left") +
  tm_compass(position = c("left", "top"))
  
```


We will look closer into Sacramento County, the county with the highest inhalation cancer risk, to look at further risk factors such as PM2.5 and diesel particulates, both of which contribute to inhalation risks.


```{r}
# All three variables just for Sacramento County
tm_shape(top3_sac) +
  tm_fill(fill = c("Cancer Risk", "Diesel Particulate Matter", "PM 2.5", "People of Color", "Low Life Expectancy", "Low Income"),
          fill.scale = list(tm_scale_intervals(values = "brewer.reds"),
                                tm_scale_intervals(values = "brewer.purples"),
                                tm_scale_intervals(values = "brewer.blues"),
                                tm_scale_intervals(values = "brewer.YlGn"),
                                tm_scale_intervals(values = "brewer.YlGn"),
                                tm_scale_intervals(values = "brewer.YlGn")),
          fill.legend = tm_legend(orientation = "landscape",
                                  position = tm_pos_in("center", "bottom"))) +
  tm_facets_wrap(nrow = 2) +
  tm_title("Toxic Air Metrics alongside Environmental Justice Metrics for Sacramento County") +
  tm_scalebar(position = "left") +
  tm_compass(position = c("left", "top"))
```

